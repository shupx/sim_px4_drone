<?xml version="1.0"?>
<launch>
    <!-- 
        Perfect MAVROS Drone Simulator Launch File
        
        This launch file starts a perfect ideal drone simulator that:
        - Subscribes to mavros/setpoint_raw/local
        - Publishes desired state directly to mavros/local_position/* topics
        - Publishes mavros/state with armed=true and mode=OFFBOARD
        
        Parameters:
        - pose_publish_rate: Rate (Hz) for publishing pose messages (default: 30.0)
        - velocity_publish_rate: Rate (Hz) for publishing velocity messages (default: 30.0)
        - odom_publish_rate: Rate (Hz) for publishing odometry messages (default: 30.0)
        - state_publish_rate: Rate (Hz) for publishing state messages (default: 10.0)
        - init_x: Initial X position (default: 0.0)
        - init_y: Initial Y position (default: 0.0)
        - init_z: Initial Z position (default: 0.0)
        - init_yaw: Initial yaw angle in degrees (default: 0.0)
        - open_rviz: Open RViz for visualization (default: true)
    -->
    
    <arg name="init_x" default="0.0" />
    <arg name="init_y" default="0.0" />
    <arg name="init_z" default="1.0" />
    <arg name="init_yaw" default="0.0" />
    <arg name="open_rviz" default="true" />

    <arg name="pose_publish_rate" default="30.0" />
    <arg name="velocity_publish_rate" default="30.0" />
    <arg name="odom_publish_rate" default="30.0" />
    <arg name="state_publish_rate" default="10.0" />

    <arg name="visualize_max_freq" default="20"/> <!-- (Hz) Maximum  Maximum base_link tf publishing rate  -->
    <arg name="enable_history_path" default="true"/> <!-- Enable visualizing history path  -->
    <arg name="visualize_path_time" default="30"/> <!-- (s) displaying history path time -->
    
    <node pkg="px4_rotor_sim" 
            type="perfect_mavros_quadrotor_sim_node" 
            name="perfect_mavros_drone"
            output="screen">
        <param name="pose_publish_rate" value="$(arg pose_publish_rate)" />
        <param name="velocity_publish_rate" value="$(arg velocity_publish_rate)" />
        <param name="odom_publish_rate" value="$(arg odom_publish_rate)" />
        <param name="state_publish_rate" value="$(arg state_publish_rate)" />
        <param name="init_x" value="$(arg init_x)" />
        <param name="init_y" value="$(arg init_y)" />
        <param name="init_z" value="$(arg init_z)" />
        <param name="init_yaw" value="$(arg init_yaw)" />
    </node>

    <!-- Include drone visualizer -->
    <include file="$(find px4_rotor_sim)/launch/drone_visualizer_single_no_prefix.launch">
        <arg name="open_rviz" value="$(arg open_rviz)" />
        <arg name="visualize_max_freq" value="$(arg visualize_max_freq)"/> <!-- (Hz) Maximum  Maximum base_link tf publishing rate  -->
        <arg name="enable_history_path" value="$(arg enable_history_path)"/> <!-- Enable visualizing history path  -->
        <arg name="visualize_path_time" value="$(arg visualize_path_time)"/> <!-- (s) displaying history path time -->
    </include>
    
</launch>
